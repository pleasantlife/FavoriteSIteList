# Droid Knights 2019

## 3. 오프라인과 앱 서비스 (Fast Retailing / 김현/ https://rannte.tistory.com)

### 들어가기 앞서
 - 네트워크 접속성공률 99.97%
 - 네트워크 전송성공률 99.43%
 - 접속실패 케이스가 거의 없다!

### 네트워크가 연결되지 않을 수 있는 경우
 - 엘리베이터, 지하, 높은 건물 내부 등 다양한 장소에서 네트워크 접속이 되지 않을 수 있다!
 - 네트워크가 끊어지면 어떻게 하지?
 - 일반적인 네트워크 오류 대응 : 빈 화면 + Retry 버튼

### 오프라인 이슈에 대한 대응사례
 - Clean Architecture를 기반으로 상위 아키텍처에 종속성을 갖도록 설계.
 - 필요한 요소들은 Dagger를 통해 Injection.
 

 #### 1. 예외처리
  - 데이터를 저장해 두었다가 데이터 갱신에 문제가 생겼을 경우 대체하여 사용
  - 정상적으로 서비스가 제공되고 있을 때 Cache에 데이터를 저장하고, 일반적인 상황대로 진행
  - 에러가 발생하면 마지막으로 저장한 Cache Layer에서 데이터 로딩
  - 최신 화면을 제공하지 못할 수 있으므로, 오류 발생시 별도의 스트림을 생성하여 '에러가 났음'을 따로 표시하도록 함.
  - 메모리 캐시 기반, 유효 기간이 있음.

 #### 2. 오프라인 모드 
  - 데이터 사용을 임의로 제한하여 오프라인 데이터로만 서비스를 제공하는 방법
  - 스포티파이나 유튜브에서 찾아볼 수 있는 예시.
  - 로컬DB와 서버를 전환
  - 로컬DB를 오프라인 외의 상황에도 사용한다면...?

#### 3. 오프라인 우선 모드
 - 로컬DB를 오프라인 이외의 상황에도 사용하기 위해
 - 화면 갱신은 로컬DB의 변화에 종속하도록 하고 서버와 동기화를 통하여 서비스를 제공하는 방법
 - Updater라는 개념을 도입!
 - API에서 받아온 정보를 특정한 기준(임의 설정)을 통해 DB에 넣을지, 아닐지를 결정함. 
 - 0.1초 로딩!


### 업데이터(Updater)
 - 온라인 / 오프라인 데이터에 대한 인터페이스 제공
 - 온라인 / 오프라인 간의 동기화 작업 담당
 - 오프라인 스토리지 변경에 대한 Observer 제공

### 오프라인 데이터 처리 
 - 마지막 동기화 시간 기록
 - 민감한 데이터는 유효시간 설정
 - 유효시간이 지난 데이터를 표시할 때에는 UI에 표시


### 질문 
 - 용량이 많이 늘어날텐데?
  > 