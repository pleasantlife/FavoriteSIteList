# 천만 사용자를 위한 AWS 클라우드 아키텍쳐 진화하기
 - 김준형 솔루션즈 아키텍트, AWS


## 사용자가 한명이면
 - 페일오버 필요없음
 - LightSail이라는 서비스를 이용해볼 것!

## 사용자가 한명이상
 - 데이터가 커질수록 스스로 관리하는 EC2보다 관리형데이터베이스 서비스를 이용해볼 것.(Document DB, Dynamo DB 등))

 ### Amazon Aurora
  - 서버리스 옵션
  - MySQL 또는 Postgres 호환
  - 자동으로 스토리지 확장 (최대 64TB)
  - 최대 15개의 읽기 전용 복제본
  - S3에 지속적인 백업
  - 3개의 AZ에 6개의 데이터 복제

### Nosql을 쓸 것인가?
 - sql부터 시작해보자!  
 - 시장에서 잘 알려진 기술
 - 유용한 코드, 커뮤니티, 책, 도구들
 - 수백만 사용자 수를 확보하더라도, sql DB는 유용
 - 확장성을 위해 명확한 패턴들
 - 연간 데이터 크기가 5TB이거나 빈번한 사용을 요구한다면 NoSQL을 고려해볼 것

 ### 등록, 로그인
 - Amazon Cognito

 ### AWS 보안
  - IAM으로 인가 관리
  - DB의 암호를 변경할 때 도움을 주는 Secrets Manager
  - 인증서 관리를 위한 AWS Certificate Manager
  - 암호화 키를 관리하고 저장하는 Key Management Service
  - AWS Config에서 전체 보안 컨트롤

 ## 사용자 수가 100명 이상 
  - Amazon RDS로 전환

## 사용자 수가 1000명 이상
 - 가용성이 중요!
 
### Application Load Balancer (ALB)
 - 수평적으로 확장 가능

## 사용자수 10,000명 이상 
 - 데이터를 처리하는 DB에도 확장성을 가져가야 함
 - 정척컨텐츠는 S3와 CloudFront로!

 ### Amazon Simple Storeage Service
  - 오브젝트 기반 스토리지
  - 높은 내구성 (99.999999999%)
  - 정적 자산에 최적화
  - 무한 확장 가능
  - 오브젝트 당 5TB까지 지원
  - 전송 중/ 전송 후 암호화 지원

  ### CloudFront
   - 빠른 컨텐츠전달을 위해 캐싱
   - 오리진 측의 부담을 덜어줌
   - 동적 /정적 컨텐츠 / 스트리밍 비디오
   - 사용자 SSL 인증서
   - 낮은 TTL (0초까지 설정가능)
   - AWS에 최적화

 ### 데이터레이어의 부하분산  
  - 캐싱 이용! Amazon ElastiCache
  - DynamoDB를 통해 간단한 정보조회 전담
  - DynamoDB는 글로벌 테이블을 제공하여 멀티리전(서울에서 만든 테이블을 미국의 테이블과 동기화 가능!) 동기화 가능.


 ## 확장성 높이기 
  
  ### 오토 스케일링
   

## 사용자가 5만 이상! => 자동화를 적용!
 - EC2가 너무 많아져서 자동화 적용이 필요!

 ### AWS Systems Manager
  - aws 클라우드 뿐만 아니라 온프레미스도 지원
  - 관리자 작업 자동화
  - 쉘 접근 (베스천 서버 없이)
  - 저렴한 가격


## MicroService (MSA)
 - 기존 모놀리식 아키텍처 : 사용자 인터페이스 / 비즈니스 로직 / 데이터 접근이 모두 의존도를 가지고 있어서 개선에 많은 준비와 노력이 필요함
 - Service Oriented Architecture : 프리젠테이션 티어 / 로직 티어 / 데이터 티어 분리
 - AWS X-RAY로 어느 구간에서 문제가 있는지 시각화 해서 보여줌

## 사용자 수 1백만 이상 
 - 멀티 az(멀티 가용영역)
 - 계층 사이에 Elastic Load Balancing(ELB)
 - 오토 스케일링
 - SOA

## 사용자 수 5백만~1천만 명 
 
 ### 데이터베이스 이슈
  - 역할별로 여러 DB로 쪼개기
  - 샤딩
  - 일부 기능은 다른 타입의 DB로 이관


 ### 사용자 수 1천만 명 이상 
  - 어플리케이션을 더 정교하게 튜닝
  - 더 많은 영역에서 마이크로서비스 적용
  - 멀티 AZ에서 멀티 리전으로 진화
  - 전체 스택에 대해서 깊은 분석 진행
  - 가능하다면 언제나 서버리스 적용

